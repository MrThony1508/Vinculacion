{% extends "docente.html" %}

{% block contenido %}
<div class="container animate-in">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      
      <div class="mb-4">
        <h4 class="fw-bold mb-1" style="color: #194077;">
          <i class="bi bi-person-plus-fill me-2"></i>Registrar Nuevo Estudiante
        </h4>
        <p class="text-muted">Complete la información técnica del estudiante para las prácticas académicas.</p>
      </div>

      <div class="card shadow-sm border-0" style="border-radius: 15px;">
        <div class="card-body p-4 p-md-5">
          
          <form action="{% url 'guardar_estudiante' %}" method="POST" id="frm_estudiante">
            {% csrf_token %}
            
            <input type="hidden" id="estudiante_id" name="id" value="{{ estudiante.id|default:'' }}">

            <div class="row g-4">
              <div class="col-12">
                <h6 class="text-uppercase fw-bold text-secondary mb-3" style="font-size: 0.8rem; letter-spacing: 1px;">
                  Información Personal
                </h6>
                <hr class="mt-0 mb-4 opacity-10">
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Nombre</label>
                <div class="input-group">
                  <span class="input-group-text bg-light border-end-0 text-muted"><i class="bi bi-person"></i></span>
                  <input type="text" name="nombre" class="form-control border-start-0" placeholder="Ej: Juan" value="{{ estudiante.nombre }}" required>
                </div>
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Apellido</label>
                <div class="input-group">
                  <span class="input-group-text bg-light border-end-0 text-muted"><i class="bi bi-person"></i></span>
                  <input type="text" name="apellido" class="form-control border-start-0" placeholder="Ej: Pérez" value="{{ estudiante.apellido }}" required>
                </div>
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Cédula de Identidad</label>
                <div class="input-group">
                  <span class="input-group-text bg-light border-end-0 text-muted"><i class="bi bi-card-heading"></i></span>
                  <input type="text" id="cedula" name="cedula" class="form-control border-start-0" placeholder="050xxxxxxx" value="{{ estudiante.cedula }}" required>
                </div>
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Correo Institucional</label>
                <div class="input-group">
                  <span class="input-group-text bg-light border-end-0 text-muted"><i class="bi bi-envelope"></i></span>
                  <input type="email" id="correo_institucional" name="correo_institucional" class="form-control border-start-0" placeholder="juan.perez@utc.edu.ec" value="{{ estudiante.correo_institucional }}" required>
                </div>
              </div>

              <div class="col-12 mt-5">
                <h6 class="text-uppercase fw-bold text-secondary mb-3" style="font-size: 0.8rem; letter-spacing: 1px;">
                  Detalles Académicos y Prácticas
                </h6>
                <hr class="mt-0 mb-4 opacity-10">
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Carrera</label>
                <div class="input-group">
                  <span class="input-group-text bg-light border-end-0 text-muted"><i class="bi bi-mortarboard"></i></span>
                  <select name="carrera" class="form-select border-start-0" required>
                    <option value="" selected disabled>Seleccione una carrera...</option>
                    <option value="Sistemas de información" {% if estudiante.carrera == "Sistemas de información" %}selected{% endif %}>Sistemas de información</option>
                    <option value="Electromecánica" {% if estudiante.carrera == "Electromecánica" %}selected{% endif %}>Electromecánica</option>
                    <option value="Industrial" {% if estudiante.carrera == "Industrial" %}selected{% endif %}>Industrial</option>
                    <option value="Electricidad" {% if estudiante.carrera == "Electricidad" %}selected{% endif %}>Electricidad</option>
                    <option value="Hidráulica" {% if estudiante.carrera == "Hidráulica" %}selected{% endif %}>Hidráulica</option>
                    <option value="Software" {% if estudiante.carrera == "Software" %}selected{% endif %}>Software</option>
                  </select>
                </div>
              </div>

              <div class="col-md-6 ">
                  <label class="form-label small fw-semibold">Asignación de Prácticas</label>
                  <div class="input-group">
                      <span class="input-group-text bg-light border-end-0 text-muted">
                          <i class="bi bi-briefcase"></i>
                      </span>
                      <select name="tipo_practica" class="form-select border-start-0 ps-0" required>
                          <option value="" selected disabled>Seleccione una opción...</option>
                          <option value="PPP" {% if estudiante.tipo_practica == "PPP" %}selected{% endif %}>PPP - Prácticas Preprofesionales</option>
                          <option value="Servicio Comunitario" {% if estudiante.tipo_practica == "Servicio Comunitario" %}selected{% endif %}>Servicio Comunitario</option>
                      </select>
                  </div>
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Semestre</label>
                <div class="input-group">
                  <span class="input-group-text bg-light border-end-0 text-muted"><i class="bi bi-layers"></i></span>
                  <select name="semestre" class="form-select border-start-0" required>
                    <option value="" selected disabled>Seleccione semestre...</option>
                    <option value="Cuarto" {% if estudiante.semestre == "Cuarto" %}selected{% endif %}>Cuarto</option>
                    <option value="Quinto" {% if estudiante.semestre == "Quinto" %}selected{% endif %}>Quinto</option>
                    <option value="Sexto" {% if estudiante.semestre == "Sexto" %}selected{% endif %}>Sexto</option>
                    <option value="Séptimo" {% if estudiante.semestre == "Séptimo" %}selected{% endif %}>Séptimo</option>
                  </select>
                </div>
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Periodo Académico</label>
                <div class="input-group">
                  <span class="input-group-text bg-light border-end-0 text-muted"><i class="bi bi-calendar-event"></i></span>
                  <input type="text" name="periodo_academico" class="form-control border-start-0" placeholder="Ej: 2024 - 2025" value="{{ estudiante.periodo_academico }}" required>
                </div>
              </div>
            </div>

            <div class="d-flex justify-content-end gap-3 mt-5">
              <a href="{% url 'lista_estudiantes' %}" class="btn btn-light px-4 fw-semibold border" style="border-radius: 8px;">
                Cancelar
              </a>
              <button type="submit" class="btn px-5 fw-bold text-white shadow-sm" 
                      style="background-color: #194077; border-radius: 8px;">
                <i class="bi bi-check-circle me-2"></i>Guardar Estudiante
              </button>
            </div>
          </form>

        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .form-control:focus, .form-select:focus {
    border-color: #194077;
    box-shadow: 0 0 0 0.25rem rgba(25, 64, 119, 0.1);
  }
  .input-group-text {
    border-color: #dee2e6;
  }
</style>

<script>
  $("#frm_estudiante").validate({
    errorClass: "text-danger small mt-1",
    rules: {
      nombre: { required: true },
      apellido: { required: true },
      cedula: { 
        required: true, 
        digits: true, 
        minlength: 10, 
        maxlength: 10,
        remote: {
          url: "{% url 'validar_cedula_estudiante' %}",
          type: "get",
          data: {
            estudiante_id: function() { return $("#estudiante_id").val(); }
          }
        }
      },
      correo_institucional: { 
        required: true, 
        email: true,
        remote: {
          url: "{% url 'validar_correo_estudiante' %}",
          type: "get",
          data: {
            correo: function() { return $("#correo_institucional").val(); },
            estudiante_id: function() { return $("#estudiante_id").val(); }
          }
        }
      },
      carrera: { required: true },
      tipo_practica: { required: true },
      semestre: { required: true },
      periodo_academico: { required: true }
    },
    messages: {
      nombre: "El nombre es obligatorio",
      apellido: "El apellido es obligatorio",
      cedula: {
        required: "La cédula es obligatoria",
        digits: "Solo se permiten números",
        minlength: "Debe tener 10 dígitos",
        maxlength: "No puede exceder 10 dígitos",
        remote: "Esta cédula ya está registrada"
      },
      correo_institucional: {
        required: "El correo es obligatorio",
        email: "Ingrese un correo válido",
        remote: "Este correo ya está en uso"
      },
      carrera: "Seleccione una carrera",
      tipo_practica: "Especifique el tipo de práctica",
      semestre: "Seleccione el semestre",
      periodo_academico: "Ingrese el periodo"
    }
  });
</script>
{% endblock %}